
================================================================================
 OPERACIN METAMORFOSIS: ARBOR STUDIO (ESPECIFICACIN TCNICA MAESTRA)
================================================================================

VISIN:
Convertir Arbor UI en un CMS Descentralizado ("Browser-to-Git").
- Frontend: Edita y crea Pull Requests.
- Backend: GitHub API (Maneja usuarios, permisos y versiones).
- Datos: Arbor Knowledge (Repositorio de contenido est谩tico).

ESTRATEGIA: DIVIDE Y VENCERS.

---

FASE 1: PREPARACIN DEL CONTENIDO (REPO: ARBOR KNOWLEDGE)
Modificaciones en el repositorio donde viven los cursos.

1.  **ACTUALIZACIN DEL COMPILADOR (`builder_script.txt`)**
    *   **Objetivo Cr铆tico:** El Frontend necesita saber qu茅 archivo `.md` corresponde a cada nodo del 谩rbol para poder editarlo.
    *   **Acci贸n:** Modificar el script Python para agregar una nueva propiedad `sourcePath` a cada nodo en el JSON de salida.
    *   **Ejemplo:**
        ```json
        {
          "id": "intro-biologia",
          "name": "Introducci贸n",
          "sourcePath": "content/ES/01_Ciencias/01_Intro.md" // <--- NUEVO CAMPO NECESARIO
        }
        ```

2.  **GOBERNANZA (`.github/CODEOWNERS`)**
    *   **Acci贸n:** Crear este archivo en la ra铆z del repo de contenido.
    *   **L贸gica:** Define qui茅n aprueba los cambios en cada carpeta.
    *   **Contenido:**
        ```text
        # Sintaxis: [Patr贸n de carpeta] [Usuario de GitHub]
        /content/ES/   @profesor-spaniard
        /content/EN/   @teacher-smith
        ```

---

FASE 2: INFRAESTRUCTURA FRONTEND (REPO: ARBOR UI)
Nuevos servicios y configuraci贸n en la App Angular/Vanilla.

1.  **DEPENDENCIA OCTOKIT**
    *   Importar `Octokit` (SDK de GitHub) en `index.html` v铆a m贸dulo ES para interactuar con la API sin backend.

2.  **SERVICIO DE GITHUB (`src/services/github.js`)**
    Este servicio debe manejar toda la l贸gica "sucia" de Git.
    *   **Configuraci贸n:** Debe detectar autom谩ticamente el `owner` y `repo` bas谩ndose en la URL del `data.json` cargado, o permitir configuraci贸n manual.
    *   **Auth:** Implementar manejo de **Personal Access Tokens (PAT)**. (Es la forma m谩s simple para un MVP serverless; el usuario pega su token una vez y se guarda en SessionStorage encriptado o memoria).
    *   **M茅todos Clave:**
        *   `initialize(token, repoUrl)`: Configura la instancia Octokit.
        *   `getFile(path)`: Obtiene el contenido RAW y el SHA (hash) del archivo (necesario para updates).
        *   `createPr(filePath, newContent, userMsg)`:
            1.  Obtener referencia SHA de `main`.
            2.  Crear rama `feat/edit-{timestamp}`.
            3.  Hacer commit del archivo en la nueva rama.
            4.  Crear Pull Request comparando con `main`.

---

FASE 3: INTERFAZ DE EDICIN (UI/UX)

1.  **MODAL DE EDICIN (`src/components/editor-modal.js`)**
    Un componente complejo que reemplaza la vista de lectura.
    *   **Split View:**
        *   Izquierda: Editor de c贸digo (TextArea simple o librer铆a ligera como CodeJar). Debe resaltar sintaxis Markdown b谩sica.
        *   Derecha: Vista previa en tiempo real (usando el parser existente de Arbor).
    *   **Toolbar:** Botones r谩pidos para insertar snippets de Arbor:
        *   `[IMG]` -> Inserta `@image: url`
        *   `[QUIZ]` -> Inserta plantilla de Quiz.
    *   **Footer:**
        *   Input: "Descripci贸n del cambio" (ej: "Correg铆 fecha en p谩rrafo 2").
        *   Bot贸n: "PROPONER CAMBIOS" (Dispara el flujo de PR).

2.  **INTEGRACIN EN `content.js`**
    *   A帽adir bot贸n "锔 EDITAR" junto al t铆tulo de la lecci贸n.
    *   **L贸gica de visibilidad:** El bot贸n solo aparece si el usuario ha configurado su Token de GitHub en los ajustes.

3.  **PANEL DE AJUSTES (Settings)**
    *   A帽adir secci贸n "Modo Contribuidor".
    *   Input para pegar el GitHub Personal Access Token.
    *   Selector de Repositorio (si hay m煤ltiples fuentes).

---

FASE 4: FLUJO DE TRABAJO (LA PELCULA)

1.  **Configuraci贸n (Solo una vez):**
    *   El Profesor entra a Arbor. Va a Ajustes.
    *   Pega su Token de GitHub (instrucciones en pantalla de c贸mo obtenerlo).
    *   Arbor valida el token y muestra "Conectado como @usuario".

2.  **Detecci贸n:**
    *   El Profesor navega a "Historia Romana".
    *   Hace clic en "锔 EDITAR".
    *   Arbor UI lee el campo `sourcePath` del nodo actual (`content/historia/roma.md`).
    *   Arbor UI llama a GitHub API para descargar el texto crudo de ese archivo.

3.  **Edici贸n:**
    *   Se abre el Modal. El profesor cambia el texto.
    *   Hace clic en "Proponer Cambios".

4.  **Disparo:**
    *   Arbor UI bloquea la pantalla: "Enviando solicitud a la central...".
    *   Crea Rama -> Sube Archivo -> Crea Pull Request.
    *   Muestra mensaje: "隆xito! Solicitud de cambio #45 creada. El administrador la revisar谩".

---

FASE 5: GESTIN DE MEDIA (IMGENES)
*Problema:* Los profesores no saben subir fotos a servidores FTP.
*Soluci贸n:*
1.  En el Editor, permitir "Pegar imagen" (Ctrl+V) o Drag & Drop.
2.  El script convierte la imagen a Base64.
3.  Usa la API de GitHub para subir el archivo binario a una carpeta `assets/uploads/` en la *misma rama* que se est谩 creando.
4.  Inserta autom谩ticamente la URL cruda de GitHub en el markdown: `@image: https://raw.githubusercontent.../assets/uploads/foto1.jpg`.

---

FASE 6: AUTOMATIZACIN (EL CEREBRO INVISIBLE)
*Objetivo:* Que el `data.json` se actualice solo cuando se aprueba un cambio, eliminando la necesidad de correr el script manualmente.

1.  **GITHUB ACTION (`.github/workflows/build.yml`)**
    *   Crear este archivo en el repositorio `Arbor Knowledge`.
    *   **Trigger:** `on: push: branches: [ "main" ]`.
    *   **Pasos del Robot:**
        1.  Checkout del c贸digo.
        2.  Instalar Python 3.
        3.  Ejecutar `python builder_script.txt`.
        4.  Detectar si `data/data.json` ha cambiado.
        5.  Si cambi贸, hacer Commit y Push autom谩tico a `main` con el usuario "Arbor Bot".

    *Resultado:* 30 segundos despu茅s de que el Decano apruebe el cambio de Mariela, el mapa se regenera solo y todos los alumnos del mundo ven la actualizaci贸n.

================================================================================
FIN DEL PLAN DE BATALLA
================================================================================
