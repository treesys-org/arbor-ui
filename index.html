
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Arbor Academy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
  
  <!-- Optimization: Preconnect to CDNs -->
  <link rel="preconnect" href="https://cdn.tailwindcss.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://esm.sh">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Nunito', 'sans-serif'],
          }
        }
      }
    }
  </script>
  
  <!-- D3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- CRITICAL POLYFILLS FOR BROWSER COMPATIBILITY -->
  <script>
    // Fixes 'process is not defined' error common with node libraries like Octokit in browser
    window.process = { env: { NODE_ENV: 'production' } };
  </script>

  <style>
    /* NATIVE APP LOCK: Fixes the viewport to prevent swaying/rubber-banding */
    html {
      width: 100%;
      height: 100%;
      overflow: hidden;
      overscroll-behavior: none;
    }

    body {
      font-family: 'Nunito', sans-serif;
      width: 100%;
      height: 100%;
      position: fixed; /* Locks the body in place relative to the viewport */
      overflow: hidden; 
      overscroll-behavior: none; /* Disables pull-to-refresh/bounce effects */
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      margin: 0;
      padding: 0;
    }
    
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; }
    
    /* Animations */
    .animate-in { animation: fadeIn 0.3s ease-in-out forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    .animate-slide-in { animation: slideIn 0.3s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

    /* Web Component loading helper */
    :not(:defined) { display: none; }

    /* EDITOR VISUAL STYLES (ARBOR STUDIO PORT) */
    .prose h1, .prose h2, .prose h3 { margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2; font-weight: 800; }
    .prose h1 { font-size: 2em; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.3em; }
    .prose h2 { font-size: 1.5em; color: #334155; }
    .dark .prose h2 { color: #94a3b8; }
    .prose p { margin-bottom: 1em; line-height: 1.6; }
    .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
    .prose blockquote { border-left: 4px solid #fbbf24; padding-left: 1em; margin: 1.5em 0; font-style: italic; color: #4b5563; }
    .dark .prose blockquote { color: #9ca3af; }
    
    .edit-block-wrapper:hover {
        outline: 1px dashed #cbd5e1;
    }
    .dark .edit-block-wrapper:hover {
        outline: 1px dashed #475569;
    }

    /* TREE VIEW STYLES */
    .tree-item.drag-over {
        background-color: #e0f2fe;
        border: 1px dashed #3b82f6;
    }
    .dark .tree-item.drag-over {
        background-color: #0c4a6e;
        border: 1px dashed #38bdf8;
    }
    .tree-item.dragging {
        opacity: 0.5;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "rxjs": "https://esm.sh/rxjs@^7.8.2?conditions=es2015",
    "rxjs/operators": "https://esm.sh/rxjs@^7.8.2/operators?conditions=es2015",
    "rxjs/ajax": "https://esm.sh/rxjs@^7.8.2/ajax?conditions=es2015",
    "rxjs/webSocket": "https://esm.sh/rxjs@^7.8.2/webSocket?conditions=es2015",
    "rxjs/testing": "https://esm.sh/rxjs@^7.8.2/testing?conditions=es2015",
    "rxjs/fetch": "https://esm.sh/rxjs@^7.8.2/fetch?conditions=es2015",
    "@angular/compiler": "https://esm.sh/@angular/compiler@^21.0.6?external=rxjs",
    "@angular/platform-browser": "https://esm.sh/@angular/platform-browser@^21.0.6?external=rxjs",
    "@angular/core": "https://esm.sh/@angular/core@^21.0.6?external=rxjs",
    "@angular/router": "https://esm.sh/@angular/router@^21.0.6?external=rxjs",
    "@angular/common": "https://esm.sh/@angular/common@^21.0.6?external=rxjs",
    "@angular/forms": "https://esm.sh/@angular/forms@^21.0.6?external=rxjs",
    "vite": "https://esm.sh/vite@^7.3.0?external=rxjs",
    "octokit": "https://esm.sh/@octokit/rest?bundle", 
    "@google/genai": "https://esm.sh/@google/genai",
    "@mlc-ai/web-llm": "https://esm.sh/@mlc-ai/web-llm",
    "path": "https://esm.sh/path@^0.12.7?external=rxjs"
  }
}
</script>
</head>
<body class="bg-[#f7f9fa] dark:bg-slate-950 text-slate-700 dark:text-slate-200 transition-colors duration-300">
  
  <!-- Use w-full/h-full instead of screen units to respect fixed body constraints -->
  <div id="app" class="h-full w-full flex relative overflow-hidden">
     <!-- Sidebar -->
     <arbor-sidebar></arbor-sidebar>
     
     <main class="flex-1 relative flex flex-col h-full pt-16 md:pt-0">
        <!-- Graph Area -->
        <div class="w-full h-full absolute inset-0 z-10">
            <arbor-graph></arbor-graph>
        </div>
     </main>
     
     <!-- Content Panel (Slide over) -->
     <arbor-content></arbor-content>
     
     <!-- Modals Container -->
     <arbor-modals></arbor-modals>
     
     <!-- Editor Modal -->
     <arbor-editor></arbor-editor>

     <!-- Sage (AI) Modal -->
     <arbor-sage></arbor-sage>

     <!-- Progress Widget (Top Right) -->
     <arbor-progress-widget></arbor-progress-widget>
  </div>

  <!-- Entry Point -->
  <script type="module" src="./src/main.js"></script>
</body>
</html>
